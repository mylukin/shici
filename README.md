# 文言文转语音工具

这是一个使用 FastAPI 和 Edge TTS 构建的文言文转语音工具，可以将中文文本（尤其是文言文）转换为自然流畅的语音。该工具支持多种中文语音和语速、音量调节，适合学习文言文的发音或制作有声读物。

## 功能特点

- **多种语音转换模式**：
  - 单段文本转语音测试
  - 上传 TXT 文件批量转换（自动分段）
  - 处理 shici.txt 文件（按条目自动分割并转换）
- **语音参数调节**：
  - 语速控制（-50% 到 +50%）
  - 音量控制（轻声到高声）
  - 多种中文发音人选择
- **友好的用户界面**：
  - 响应式设计，适配各种设备
  - 文件拖放上传
  - 音频实时预览
  - 美观的卡片式布局

## 安装

### 方法一：使用 pip 安装依赖

1. 克隆仓库

```bash
git clone <repository-url>
cd <repository-directory>
```

2. 安装依赖

```bash
pip install -r requirements.txt
```

3. 运行应用

```bash
python app.py
```

### 方法二：使用 Makefile（推荐）

使用提供的 Makefile 可以自动创建虚拟环境并管理应用生命周期：

```bash
# 显示可用命令
make help

# 创建虚拟环境并启动应用
make run

# 停止应用
make stop

# 重启应用
make restart

# 清理环境和临时文件
make clean
```

应用将在 http://localhost:8000 上运行。

## 详细使用指南

### 1. 测试文本转语音

适合快速测试短文本的语音效果。

1. 选择语音发音人
2. 调整语速和音量滑块
3. 在文本框中输入或粘贴要转换的文本
4. 点击"转换"按钮
5. 等待处理完成后，音频将显示在下方，可直接播放

### 2. 上传文本文件转换

适合处理较长的文本文件，会自动分段处理。

1. 选择语音设置（发音人、语速）
2. 设置分段大小（字符数，默认500）
3. 将文件拖放到上传区或点击选择文件
4. 点击"上传并转换"
5. 处理完成后，分段音频将按顺序显示

### 3. 处理 shici.txt 文件

专为处理文言文词汇设计，将按词条自动分割并生成对应音频。

1. 选择语音设置
2. 点击"处理 shici.txt"按钮
3. 处理完成后，每个词条将生成单独的音频，并显示词条编号和拼音

## 文件结构

```
├── app.py                # FastAPI 应用主文件
├── utils.py              # 工具函数库
├── requirements.txt      # 依赖列表
├── Makefile              # 自动化脚本
├── README.md             # 项目说明文档
├── templates/            # HTML 模板
│   └── index.html        # 前端页面
├── static/               # 静态资源
│   └── audio/            # 生成的音频文件保存目录
└── shici.txt             # 文言文词汇示例文件
```

## Edge TTS 语音选项

应用默认提供以下中文语音选项：

- zh-CN-XiaoxiaoNeural（默认，女声）
- zh-CN-YunxiNeural（男声）
- zh-CN-YunjianNeural（男声）
- zh-CN-XiaoyiNeural（女声）
- zh-CN-YunyangNeural（男声）

## 语速与音量控制

- **语速**：可在 -50%（慢）到 +50%（快）之间调节，滑块中间位置为正常语速
- **音量**：可在 -50%（轻）到 +50%（响）之间调节

## 依赖项

- FastAPI (0.110.0): Web 框架
- Uvicorn (0.27.1): ASGI 服务器
- Edge TTS (6.1.9): 微软 Edge 浏览器的文本转语音引擎
- Jinja2 (3.1.3): 模板引擎
- Python-Multipart (0.0.9): 处理文件上传

## 技术实现

该项目使用 FastAPI 提供 Web 后端服务，结合 Edge TTS 实现高质量的文本转语音功能。前端使用纯 HTML、CSS 和 JavaScript 实现，具有现代化的响应式设计。

## 问题排查

1. **音频无法播放**：确保音频文件保存目录（static/audio）存在且有写入权限
2. **文件上传失败**：检查上传文件的编码格式，建议使用 UTF-8
3. **语音生成超时**：处理大量文本时可能需要较长时间，耐心等待或减小分段大小

## 许可证

MIT 许可证 